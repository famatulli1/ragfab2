# ==========================================
# Variables d'environnement - ragfab-backend
# ==========================================

# Base de données PostgreSQL
# Option 1: URL complète (recommandé pour Coolify)
DATABASE_URL=postgresql://raguser:ragpass123@postgres-ragfab.yourdomain.com:5432/ragdb

# Option 2: Si réseau privé Coolify, utiliser le nom de service
# DATABASE_URL=postgresql://raguser:ragpass123@ragfab-postgres:5432/ragdb

# API Embeddings (URL HTTPS du service embeddings sur Coolify)
EMBEDDINGS_API_URL=https://embeddings-ragfab.yourdomain.com
EMBEDDING_DIMENSION=1024

# JWT Secret (générer avec: openssl rand -hex 32)
JWT_SECRET=your-secret-key-change-in-production-use-openssl-rand

# Admin credentials
ADMIN_USERNAME=admin
ADMIN_PASSWORD=ChangeThisSecurePassword123!

# Mistral API
MISTRAL_API_KEY=your-mistral-api-key-here
MISTRAL_API_URL=https://api.mistral.ai
MISTRAL_MODEL_NAME=mistral-small-latest

# Chocolatine API (optionnel - provider alternatif)
CHOCOLATINE_API_URL=https://apigpt.mynumih.fr
CHOCOLATINE_MODEL_NAME=jpacifico/Chocolatine-2-14B-Instruct-v2.0.3

# CORS - URLs autorisées (séparer par des virgules)
CORS_ORIGINS=https://ragfab.yourdomain.com,https://www.ragfab.yourdomain.com

# ==========================================
# Reranking (NOUVEAU - améliore la pertinence des résultats)
# ==========================================

# Activer le reranking globalement (peut être overridé par conversation)
RERANKER_ENABLED=false

# URL du service reranker (réseau privé Coolify)
RERANKER_API_URL=http://ragfab-reranker:8002

# Modèle de reranking (doit matcher celui du service reranker)
RERANKER_MODEL=BAAI/bge-reranker-v2-m3

# Nombre de candidats à récupérer pour le reranking
RERANKER_TOP_K=20

# Nombre de résultats à retourner après reranking
RERANKER_RETURN_K=5

# ==========================================
# Quality Management (Quick Win #5)
# ==========================================

# Activer le filtrage qualité dans le RAG (true/false)
# true = Exclut automatiquement chunks blacklistés et bas-satisfaction
# false = Pas de filtrage (défaut)
QUALITY_FILTER_ENABLED=false

# Seuil de satisfaction minimum (0.0-1.0)
# Exemple: 0.3 = 30% satisfaction minimale
QUALITY_SATISFACTION_THRESHOLD=0.3

# Nombre minimum d'apparitions avant filtrage
# Évite d'exclure chunks avec peu de données
QUALITY_MIN_APPEARANCES=3

# ==========================================
# Hybrid Search (Quick Win #4)
# ==========================================

# Activer recherche hybride (vectorielle + BM25)
# Améliore la précision pour acronymes et noms propres
HYBRID_SEARCH_ENABLED=false

# ==========================================
# Thumbs Down Validation System (Quick Win #6)
# ==========================================

# Activer l'analyse IA automatique des thumbs down (true/false)
# true = Worker écoute les notifications PostgreSQL et déclenche analyses automatiquement
# false = Analyses manuelles uniquement via API
# RECOMMANDÉ: true (permet détection immédiate des problèmes)
THUMBS_DOWN_AUTO_ANALYSIS=true

# Seuil de confidence pour déclencher révision admin (0.0-1.0)
# Si confidence IA < seuil → needs_admin_review = true
# 0.7 = Équilibre (12-15% des cas nécessitent révision)
# 0.6 = Plus permissif (20-25% des cas)
# 0.8 = Plus strict (5-10% des cas)
# RECOMMANDÉ: 0.7 (détecte les cas ambigus sans surcharger admin)
THUMBS_DOWN_CONFIDENCE_THRESHOLD=0.7

# Provider LLM pour analyse des thumbs down (chocolatine par défaut)
# Utilisera les mêmes credentials que LLM_API_URL/LLM_API_KEY
THUMBS_DOWN_LLM_PROVIDER=chocolatine

# Activer les notifications utilisateurs automatiques (true/false)
# true = Crée notifications pédagogiques pour utilisateurs avec bad_question
# false = Notifications manuelles uniquement via admin
# RECOMMANDÉ: true (améliore formulation questions des utilisateurs)
THUMBS_DOWN_AUTO_NOTIFICATIONS=true

# Note: Les autres paramètres LLM sont hérités de la configuration générique LLM
# (LLM_API_URL, LLM_API_KEY, LLM_MODEL_NAME, LLM_TIMEOUT)

# ==========================================

# Logs
LOG_LEVEL=INFO

# Port d'exposition
PORT=8000
